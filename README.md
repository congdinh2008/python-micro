# üöÄ Product Catalog Service - RESTful API v·ªõi FastAPI

API RESTful ƒë·ªÉ qu·∫£n l√Ω s·∫£n ph·∫©m v√† x√°c th·ª±c ng∆∞·ªùi d√πng v·ªõi JWT, x√¢y d·ª±ng b·∫±ng FastAPI, SQLAlchemy 2.0, PostgreSQL, v√† √°p d·ª•ng Repository Pattern.

## üéØ M·ª•c ti√™u

- X√¢y d·ª±ng RESTful API chuy√™n nghi·ªáp v·ªõi FastAPI
- Qu·∫£n l√Ω s·∫£n ph·∫©m v√† x√°c th·ª±c ng∆∞·ªùi d√πng b·∫±ng JWT
- √Åp d·ª•ng Repository Pattern v√† Clean Architecture
- S·ª≠ d·ª•ng SQLAlchemy 2.0 v·ªõi PostgreSQL/SQLite
- Qu·∫£n l√Ω schema b·∫±ng Alembic migrations

## ‚ú® T√≠nh nƒÉng

### Authentication & Authorization
- ‚úÖ **ƒêƒÉng k√Ω t√†i kho·∫£n**: `POST /register` - T·∫°o user m·ªõi v·ªõi username v√† password
- ‚úÖ **ƒêƒÉng nh·∫≠p**: `POST /login` - L·∫•y JWT token ƒë·ªÉ authentication

### Qu·∫£n l√Ω S·∫£n ph·∫©m
- ‚úÖ **T·∫°o s·∫£n ph·∫©m**: `POST /products` - T·∫°o s·∫£n ph·∫©m m·ªõi (y√™u c·∫ßu JWT)
- ‚úÖ **L·∫•y danh s√°ch**: `GET /products` - L·∫•y t·∫•t c·∫£ s·∫£n ph·∫©m v·ªõi pagination (public)
- ‚úÖ **L·∫•y chi ti·∫øt**: `GET /products/{id}` - Chi ti·∫øt m·ªôt s·∫£n ph·∫©m (public)
- ‚úÖ **C·∫≠p nh·∫≠t**: `PUT /products/{id}` - C·∫≠p nh·∫≠t s·∫£n ph·∫©m (y√™u c·∫ßu JWT)
- ‚úÖ **X√≥a**: `DELETE /products/{id}` - X√≥a s·∫£n ph·∫©m (y√™u c·∫ßu JWT)

## üìÅ C·∫•u tr√∫c Project

```
python-micro/
‚îú‚îÄ‚îÄ app/                          # Application package
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py                   # FastAPI application entry point
‚îÇ   ‚îú‚îÄ‚îÄ config/                   # Configuration
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ settings.py          # Environment settings v·ªõi Pydantic
‚îÇ   ‚îú‚îÄ‚îÄ database/                 # Database setup
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database.py          # SQLAlchemy engine v√† session
‚îÇ   ‚îú‚îÄ‚îÄ models/                   # SQLAlchemy ORM models
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py              # User model
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ product.py           # Product model
‚îÇ   ‚îú‚îÄ‚îÄ repositories/             # Repository Pattern (Data Access Layer)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py              # Base repository v·ªõi generic CRUD
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user_repository.py   # User repository
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ product_repository.py # Product repository
‚îÇ   ‚îú‚îÄ‚îÄ services/                 # Business Logic Layer
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth_service.py      # Authentication service
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ product_service.py   # Product service
‚îÇ   ‚îú‚îÄ‚îÄ schemas/                  # Pydantic schemas (validation)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py              # User schemas
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ product.py           # Product schemas
‚îÇ   ‚îú‚îÄ‚îÄ api/                      # API Routes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deps.py              # Dependencies (JWT verification)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py              # Auth endpoints
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ products.py          # Product endpoints
‚îÇ   ‚îî‚îÄ‚îÄ utils/                    # Utilities
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îî‚îÄ‚îÄ security.py          # Password hashing, JWT
‚îú‚îÄ‚îÄ alembic/                      # Database migrations
‚îÇ   ‚îú‚îÄ‚îÄ versions/                # Migration files
‚îÇ   ‚îî‚îÄ‚îÄ env.py                   # Alembic environment
‚îú‚îÄ‚îÄ product_manager/              # Legacy CLI app (gi·ªØ l·∫°i)
‚îú‚îÄ‚îÄ alembic.ini                   # Alembic configuration
‚îú‚îÄ‚îÄ .env.example                  # Environment variables template
‚îú‚îÄ‚îÄ requirements.txt              # Python dependencies
‚îî‚îÄ‚îÄ README.md                     # Documentation
```

## üèóÔ∏è Ki·∫øn tr√∫c v√† Nguy√™n t·∫Øc

### Clean Architecture v·ªõi Repository Pattern

```
API Layer (FastAPI Routes)
    ‚Üì
Service Layer (Business Logic)
    ‚Üì
Repository Layer (Data Access)
    ‚Üì
Models Layer (SQLAlchemy ORM)
    ‚Üì
Database (PostgreSQL/SQLite)
```

### C√°c nguy√™n t·∫Øc √°p d·ª•ng:

#### 1. Repository Pattern
- **BaseRepository**: Generic repository v·ªõi CRUD operations c∆° b·∫£n
- **UserRepository, ProductRepository**: Specific repositories k·∫ø th·ª´a BaseRepository
- T√°ch bi·ªát data access logic kh·ªèi business logic

#### 2. Dependency Injection
- FastAPI Depends() ƒë·ªÉ inject dependencies
- Database session, authentication ƒë∆∞·ª£c inject v√†o endpoints

#### 3. Security Best Practices
- **Password Hashing**: Bcrypt ƒë·ªÉ hash passwords
- **JWT Authentication**: Token-based authentication
- **Protected Endpoints**: Middleware verify JWT tokens
- **Environment Variables**: Sensitive data trong .env file

#### 4. Validation v·ªõi Pydantic
- **Request Validation**: T·ª± ƒë·ªông validate input data
- **Response Models**: Type-safe response schemas
- **Settings Management**: Type-safe environment configuration

## üöÄ H∆∞·ªõng d·∫´n C√†i ƒë·∫∑t v√† Ch·∫°y

### Y√™u c·∫ßu H·ªá th·ªëng

- Python 3.9 tr·ªü l√™n
- PostgreSQL 12+ (ho·∫∑c SQLite cho development)
- pip ho·∫∑c pipenv

### C√°c b∆∞·ªõc C√†i ƒë·∫∑t

#### 1. Clone repository
```bash
git clone https://github.com/congdinh2008/python-micro.git
cd python-micro
```

#### 2. T·∫°o Virtual Environment (khuy·∫øn ngh·ªã)
```bash
python -m venv venv

# Windows
venv\Scripts\activate

# Linux/Mac
source venv/bin/activate
```

#### 3. C√†i ƒë·∫∑t Dependencies
```bash
pip install -r requirements.txt
```

#### 4. C·∫•u h√¨nh Environment Variables
T·∫°o file `.env` t·ª´ template:
```bash
cp .env.example .env
```

S·ª≠a file `.env` v·ªõi c·∫•u h√¨nh c·ªßa b·∫°n:
```env
# Database Configuration
DATABASE_URL=sqlite:///./product_catalog.db
# Ho·∫∑c v·ªõi PostgreSQL:
# DATABASE_URL=postgresql://user:password@localhost:5432/product_catalog

# JWT Configuration
SECRET_KEY=your-secret-key-change-this-in-production-min-32-characters
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# Application Configuration
APP_NAME=Product Catalog Service
APP_VERSION=1.0.0
DEBUG=True

# CORS Configuration
ALLOWED_ORIGINS=["http://localhost:3000","http://localhost:8000"]
```

> ‚ö†Ô∏è **Security Note**: Trong production, ƒë·ªïi `SECRET_KEY` th√†nh m·ªôt chu·ªói ng·∫´u nhi√™n d√†i √≠t nh·∫•t 32 k√Ω t·ª±.

#### 5. Ch·∫°y Database Migrations
```bash
# T·∫°o migration m·ªõi (n·∫øu thay ƒë·ªïi models)
alembic revision --autogenerate -m "Description of changes"

# Ch·∫°y migrations
alembic upgrade head
```

#### 6. Ch·∫°y Application
```bash
uvicorn app.main:app --reload

# Ho·∫∑c ch·ªâ ƒë·ªãnh host v√† port
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

Server s·∫Ω ch·∫°y t·∫°i: **http://localhost:8000**

#### 7. Truy c·∫≠p API Documentation
- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

## üìñ H∆∞·ªõng d·∫´n S·ª≠ d·ª•ng API

### 1. ƒêƒÉng k√Ω User m·ªõi

```bash
curl -X POST http://localhost:8000/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "testpass123"
  }'
```

**Response**:
```json
{
  "id": 1,
  "username": "testuser",
  "is_active": true,
  "created_at": "2025-10-16T18:00:00.000000",
  "updated_at": "2025-10-16T18:00:00.000000"
}
```

### 2. ƒêƒÉng nh·∫≠p v√† l·∫•y JWT Token

```bash
curl -X POST http://localhost:8000/login \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=testuser&password=testpass123"
```

**Response**:
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer"
}
```

> üí° L∆∞u `access_token` ƒë·ªÉ s·ª≠ d·ª•ng cho c√°c requests ti·∫øp theo

### 3. T·∫°o S·∫£n ph·∫©m m·ªõi (y√™u c·∫ßu JWT)

```bash
curl -X POST http://localhost:8000/products \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <your_token>" \
  -d '{
    "name": "Laptop Dell XPS 15",
    "description": "High-performance laptop",
    "price": 25000000,
    "quantity": 10
  }'
```

**Response**:
```json
{
  "id": 1,
  "name": "Laptop Dell XPS 15",
  "description": "High-performance laptop",
  "price": 25000000.0,
  "quantity": 10,
  "created_at": "2025-10-16T18:00:00.000000",
  "updated_at": "2025-10-16T18:00:00.000000"
}
```

### 4. L·∫•y danh s√°ch S·∫£n ph·∫©m (public)

```bash
curl http://localhost:8000/products
```

**Query Parameters**:
- `skip`: S·ªë s·∫£n ph·∫©m b·ªè qua (default: 0)
- `limit`: S·ªë l∆∞·ª£ng t·ªëi ƒëa tr·∫£ v·ªÅ (default: 100)

```bash
curl "http://localhost:8000/products?skip=0&limit=10"
```

### 5. L·∫•y chi ti·∫øt S·∫£n ph·∫©m (public)

```bash
curl http://localhost:8000/products/1
```

### 6. C·∫≠p nh·∫≠t S·∫£n ph·∫©m (y√™u c·∫ßu JWT)

```bash
curl -X PUT http://localhost:8000/products/1 \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <your_token>" \
  -d '{
    "price": 24000000,
    "quantity": 15
  }'
```

> üí° Ch·ªâ c·∫ßn cung c·∫•p c√°c fields mu·ªën c·∫≠p nh·∫≠t

### 7. X√≥a S·∫£n ph·∫©m (y√™u c·∫ßu JWT)

```bash
curl -X DELETE http://localhost:8000/products/1 \
  -H "Authorization: Bearer <your_token>"
```

**Response**: 204 No Content

## üí° T√≠nh nƒÉng N·ªïi b·∫≠t

### 1. Repository Pattern
- **T√°ch bi·ªát Data Access**: Repository layer ƒë·ªôc l·∫≠p v·ªõi business logic
- **Generic Base Repository**: Reusable CRUD operations
- **Type-safe**: S·ª≠ d·ª•ng Python Generics cho type safety

### 2. JWT Authentication
- **Secure Token**: Token-based authentication v·ªõi expiration
- **Password Hashing**: Bcrypt ƒë·ªÉ b·∫£o m·∫≠t passwords
- **Protected Routes**: Middleware t·ª± ƒë·ªông verify JWT tokens

### 3. Automatic Validation
- **Pydantic Schemas**: T·ª± ƒë·ªông validate request/response data
- **Type Checking**: Type hints ƒë·∫ßy ƒë·ªß trong to√†n b·ªô codebase
- **Clear Error Messages**: Error messages r√µ r√†ng b·∫±ng ti·∫øng Vi·ªát

### 4. Database Migrations
- **Alembic Integration**: Qu·∫£n l√Ω database schema changes
- **Version Control**: Track database changes trong version control
- **Easy Rollback**: C√≥ th·ªÉ rollback migrations n·∫øu c·∫ßn

### 5. API Documentation
- **Swagger UI**: Interactive API documentation t·ª± ƒë·ªông
- **ReDoc**: Alternative documentation interface
- **OpenAPI Spec**: Standard OpenAPI 3.0 specification

### 6. CORS Support
- **Configurable Origins**: C·∫•u h√¨nh CORS cho frontend applications
- **Secure by Default**: Ch·ªâ allow origins ƒë∆∞·ª£c c·∫•u h√¨nh

## üîß Database Migrations v·ªõi Alembic

### T·∫°o Migration m·ªõi

Khi thay ƒë·ªïi models (th√™m/s·ª≠a/x√≥a fields):

```bash
alembic revision --autogenerate -m "M√¥ t·∫£ thay ƒë·ªïi"
```

### Ch·∫°y Migrations

```bash
# Upgrade ƒë·∫øn version m·ªõi nh·∫•t
alembic upgrade head

# Upgrade ƒë·∫øn m·ªôt version c·ª• th·ªÉ
alembic upgrade <revision_id>
```

### Rollback Migrations

```bash
# Downgrade v·ªÅ version tr∆∞·ªõc
alembic downgrade -1

# Downgrade ƒë·∫øn m·ªôt version c·ª• th·ªÉ
alembic downgrade <revision_id>
```

### Xem Migration History

```bash
alembic history

# Xem current version
alembic current
```

## üîê Security Notes

### Production Deployment

Khi deploy l√™n production, ƒë·∫£m b·∫£o:

1. **SECRET_KEY**: S·ª≠ d·ª•ng m·ªôt secret key m·∫°nh, ng·∫´u nhi√™n
   ```bash
   # Generate secure secret key
   openssl rand -hex 32
   ```

2. **Database URL**: Kh√¥ng commit DATABASE_URL v√†o Git
   ```bash
   # Th√™m .env v√†o .gitignore
   echo ".env" >> .gitignore
   ```

3. **HTTPS**: S·ª≠ d·ª•ng HTTPS cho production
4. **CORS**: Ch·ªâ allow origins c·∫ßn thi·∫øt
5. **Rate Limiting**: Implement rate limiting ƒë·ªÉ tr√°nh abuse
6. **Environment**: Set `DEBUG=False` trong production

### Best Practices

- ‚úÖ Lu√¥n validate input data v·ªõi Pydantic
- ‚úÖ S·ª≠ d·ª•ng environment variables cho sensitive data
- ‚úÖ Hash passwords tr∆∞·ªõc khi l∆∞u v√†o database
- ‚úÖ Set expiration time cho JWT tokens
- ‚úÖ Implement proper error handling
- ‚úÖ Log security events

## üß™ Testing

### Manual Testing v·ªõi curl

Xem ph·∫ßn "H∆∞·ªõng d·∫´n S·ª≠ d·ª•ng API" ·ªü tr√™n.

### Testing v·ªõi Swagger UI

1. Truy c·∫≠p http://localhost:8000/docs
2. Click "Try it out" tr√™n c√°c endpoints
3. Nh·∫≠p data v√† execute
4. Xem response tr·ª±c ti·∫øp

### Postman Collection

C√≥ th·ªÉ import c√°c curl commands v√†o Postman ƒë·ªÉ t·∫°o collection:
1. M·ªü Postman
2. Import ‚Üí Raw text ‚Üí Paste curl commands
3. L∆∞u th√†nh collection ƒë·ªÉ reuse

## üöÄ Production Deployment

### V·ªõi Docker (Recommended)

```dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

### V·ªõi systemd (Linux)

T·∫°o service file `/etc/systemd/system/product-catalog.service`:

```ini
[Unit]
Description=Product Catalog Service
After=network.target

[Service]
User=www-data
WorkingDirectory=/path/to/python-micro
Environment="PATH=/path/to/venv/bin"
ExecStart=/path/to/venv/bin/uvicorn app.main:app --host 0.0.0.0 --port 8000

[Install]
WantedBy=multi-user.target
```

Enable v√† start service:
```bash
sudo systemctl enable product-catalog
sudo systemctl start product-catalog
```

## üîß Troubleshooting

### L·ªói Database Connection

**Error**: `FATAL: database "product_catalog" does not exist`

**Solution**:
```bash
# T·∫°o database trong PostgreSQL
createdb product_catalog

# Ho·∫∑c s·ª≠ d·ª•ng SQLite (development)
DATABASE_URL=sqlite:///./product_catalog.db
```

### L·ªói Migration

**Error**: `Can't locate revision identified by 'xxx'`

**Solution**:
```bash
# X√≥a database v√† migrations, t·∫°o l·∫°i
rm product_catalog.db
rm alembic/versions/*.py
alembic revision --autogenerate -m "Initial migration"
alembic upgrade head
```

### L·ªói Import Module

**Error**: `ModuleNotFoundError: No module named 'app'`

**Solution**:
```bash
# ƒê·∫£m b·∫£o ch·∫°y t·ª´ th∆∞ m·ª•c g·ªëc c·ªßa project
cd /path/to/python-micro
uvicorn app.main:app --reload
```

## ü§ù Contribution

Contributions are welcome! Please:

1. Fork repository
2. Create feature branch (`git checkout -b feature/AmazingFeature`)
3. Commit changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to branch (`git push origin feature/AmazingFeature`)
5. Open Pull Request

## üìû Support

- Issues: https://github.com/congdinh2008/python-micro/issues
- Email: congdinh2008@gmail.com

## üìù Code Quality

### PEP8 Compliance
- T√™n bi·∫øn, h√†m: snake_case
- T√™n class: PascalCase
- Docstrings ƒë·∫ßy ƒë·ªß cho t·∫•t c·∫£ modules, classes, functions
- Type hints ƒë·∫ßy ƒë·ªß cho parameters v√† return values

### Architecture Principles
- **Repository Pattern**: T√°ch bi·ªát data access layer
- **Dependency Injection**: FastAPI Depends() cho loose coupling
- **Single Responsibility**: M·ªói layer c√≥ tr√°ch nhi·ªám r√µ r√†ng
- **Clean Code**: Code d·ªÖ ƒë·ªçc, d·ªÖ maintain, d·ªÖ test

## üë®‚Äçüíª T√°c gi·∫£

- **Cong Dinh**
- Repository: [python-micro](https://github.com/congdinh2008/python-micro)
- Email: congdinh2008@gmail.com

## üìÑ License

D·ª± √°n n√†y ƒë∆∞·ª£c t·∫°o ra cho m·ª•c ƒë√≠ch h·ªçc t·∫≠p v√† gi·∫£ng d·∫°y.

---

**Happy Coding! üöÄ Built with ‚ù§Ô∏è using FastAPI**
